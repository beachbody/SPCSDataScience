<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-05-08">

<title>SPCSDataScience - JupyterLab In Snowflake With SPCS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="SPCSDataScience - JupyterLab In Snowflake With SPCS">
<meta property="og:description" content="Snowpark Container Service With Streamlit">
<meta property="og:site_name" content="SPCSDataScience">
<meta name="twitter:title" content="SPCSDataScience - JupyterLab In Snowflake With SPCS">
<meta name="twitter:description" content="Snowpark Container Service With Streamlit">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SPCSDataScience</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./jupyterlab_spcs.html">Tutorials</a></li><li class="breadcrumb-item"><a href="./jupyterlab_spcs.html">JupyterLab In Snowflake With SPCS</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to SPCSDataScience</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jupyterlab_spcs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">JupyterLab In Snowflake With SPCS</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#what" id="toc-what" class="nav-link" data-scroll-target="#what">What?</a></li>
  <li><a href="#how" id="toc-how" class="nav-link" data-scroll-target="#how">How?</a></li>
  <li><a href="#why" id="toc-why" class="nav-link" data-scroll-target="#why">Why?</a></li>
  <li><a href="#youtube-walk-through" id="toc-youtube-walk-through" class="nav-link" data-scroll-target="#youtube-walk-through">Youtube Walk Through</a></li>
  <li><a href="#in-this-example" id="toc-in-this-example" class="nav-link" data-scroll-target="#in-this-example">In This Example:</a></li>
  </ul></li>
  <li><a href="#set-up-for-code-walk-through" id="toc-set-up-for-code-walk-through" class="nav-link" data-scroll-target="#set-up-for-code-walk-through">Set Up For Code Walk Through</a>
  <ul class="collapse">
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#create-local-conda-environment" id="toc-create-local-conda-environment" class="nav-link" data-scroll-target="#create-local-conda-environment">Create Local Conda Environment</a></li>
  <li><a href="#creating-a-symlink" id="toc-creating-a-symlink" class="nav-link" data-scroll-target="#creating-a-symlink">Creating a Symlink</a></li>
  <li><a href="#load-libraries-needed" id="toc-load-libraries-needed" class="nav-link" data-scroll-target="#load-libraries-needed">Load Libraries Needed</a></li>
  <li><a href="#create-session-and-execute-set-up" id="toc-create-session-and-execute-set-up" class="nav-link" data-scroll-target="#create-session-and-execute-set-up">Create Session and Execute Set Up</a></li>
  <li><a href="#configure-yaml-files" id="toc-configure-yaml-files" class="nav-link" data-scroll-target="#configure-yaml-files">Configure Yaml Files</a></li>
  <li><a href="#docker-creation" id="toc-docker-creation" class="nav-link" data-scroll-target="#docker-creation">Docker Creation</a>
  <ul class="collapse">
  <li><a href="#run-docker-build-locally" id="toc-run-docker-build-locally" class="nav-link" data-scroll-target="#run-docker-build-locally">Run Docker Build Locally</a></li>
  <li><a href="#pushing-image-to-snowflake" id="toc-pushing-image-to-snowflake" class="nav-link" data-scroll-target="#pushing-image-to-snowflake">Pushing Image To Snowflake</a></li>
  </ul></li>
  <li><a href="#look-into-service-created" id="toc-look-into-service-created" class="nav-link" data-scroll-target="#look-into-service-created">Look Into Service Created</a></li>
  </ul></li>
  <li><a href="#snowflake-application-deployment" id="toc-snowflake-application-deployment" class="nav-link" data-scroll-target="#snowflake-application-deployment">Snowflake Application Deployment</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting Started</a></li>
  <li><a href="#github-integration" id="toc-github-integration" class="nav-link" data-scroll-target="#github-integration">GitHub Integration</a></li>
  <li><a href="#exploring-results" id="toc-exploring-results" class="nav-link" data-scroll-target="#exploring-results">Exploring Results</a></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul></li>
  <li><a href="#clean-up" id="toc-clean-up" class="nav-link" data-scroll-target="#clean-up">Clean Up</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/sfc-gh-jdemlow/SPCSDataScience/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./jupyterlab_spcs.html">Tutorials</a></li><li class="breadcrumb-item"><a href="./jupyterlab_spcs.html">JupyterLab In Snowflake With SPCS</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">JupyterLab In Snowflake With SPCS</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 8, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>You can go directly to this <a href="https://github.com/sfc-gh-jdemlow/SPCSDataScience">github</a> and run this locally and follow along for the best results. If you run into errors please leave comments and I will do my best to get to them and make changes as necessary.&nbsp;</p>
</blockquote>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Welcome to my first article series on Snowflake! I hope you find it helpful and insightful for understanding how the Snowflake platform can be leveraged.</p>
<p>You can follow the most up-to-date version of this development series at <a href="https://github.com/sfc-gh-jdemlow/SPCSDataScience">this GitHub repository</a>. The branch name for this part will be <code>origin</code> as it contains the latest version of these tutorials. Ensure you check out the correct branch name to follow along.</p>
<section id="what" class="level2">
<h2 class="anchored" data-anchor-id="what">What?</h2>
<p>Snowpark Container Services is a fully managed container offering that allows you to easily deploy, manage, and scale containerized services, jobs, and functions, all within the security and governance boundaries of Snowflake, and requiring zero data movement. As a fully managed service, SPCS comes with Snowflake’s native security, RBAC support, and built-in configuration and operational best-practices.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/spcs.png" class="img-fluid figure-img"></p>
<figcaption>SPCS</figcaption>
</figure>
</div>
<p>In this tutorial SPCS addresses a gap in Snowflake’s offerings a development space for data scientists that isn’t available out of the box. Although Snowflake notebooks are on the horizon, as seen <a href="https://medium.com/snowflake/end-to-end-machine-learning-with-snowpark-ml-in-snowflake-notebooks-faa42f1f57fc">here</a>, they are not yet generally available. In the meantime, SPCS provides an effective solution that includes the ability to use git read/write capabilities. Snowflake recently introduced read-only Git integrations, but write capabilities are actively being developed. SPCS also allows you to bring your own libraries, including those not supported within the Snowflake ecosystem. By creating an image with the necessary tools and installing the Git integration of your choice, you can interact with your Git repository directly inside Snowflake. This capability is transformative for data scientists and machine learning engineers working securely within the Snowflake ecosystem.</p>
</section>
<section id="how" class="level2">
<h2 class="anchored" data-anchor-id="how">How?</h2>
<p>Through the power of Snowpark Container Services (SPCS), we can now work on our preferred platform Snowflake while maintaining the flexibility we desire. This series will unveil the seemingly endless possibilities with Snowflake.</p>
<p>Our Docker image will include persistent volumes that provide read and write access to internal stages within Snowflake. This setup allows you to log into your secure Snowflake ecosystem, pull your repository, and develop using the various compute layers offered by Snowflake. Whether your development requires large compute pools or GPUs, Snowflake’s elastic compute layer can accommodate these needs seamlessly and swiftly.</p>
<p><strong>Note:</strong> Many talented individuals and companies are already making significant advances with this technology. It’s important to clarify that this is just one approach to get started.</p>
</section>
<section id="why" class="level2">
<h2 class="anchored" data-anchor-id="why">Why?</h2>
<p>With over 8 years of experience as a Data Scientist and Machine Learning Engineer, I’ve always sought to manage all our needs directly within Snowflake. Thanks to Snowpark Container Services (SPCS), this is now feasible without needing to switch platforms. My approach is greatly influenced by the notebook development methodology popularized by Fast.ai through <code>nbdev</code>, and you’ll see a Jupyter Notebook-first approach throughout this series.</p>
<p>Jeremy Howard has been an invaluable mentor to numerous prominent open-source developers, and I extend my gratitude to him for his contributions to the community. While you may not align with this development strategy, remember that it is flexible. If you prefer a different IDE, you can modify the Docker image to support Visual Studio Code and continue your work there. Initially, our setup will support Python in Jupyter Lab, but it is designed to be adaptable to other programming environments such as R Studio, Scala, or any other language that fits your development preferences.</p>
</section>
<section id="youtube-walk-through" class="level2">
<h2 class="anchored" data-anchor-id="youtube-walk-through">Youtube Walk Through</h2>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/FaLgQCbQWjA?si=2jnuCgVVXuhGGexi" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="in-this-example" class="level2">
<h2 class="anchored" data-anchor-id="in-this-example">In This Example:</h2>
<p>This GitHub repository demonstrates a basic yet complete CI/CD process centered around Snowflake. The GitHub Action in this repo conducts both training and inference of a model sequentially. However, the idea is to schedule your inference or training with any tool. You can use the Snowflake Labs action <a href="https://github.com/Snowflake-Labs/snowflake-cli-action">here</a>, but I had already developed the one used in this repo before its release—feel free to adjust as needed.</p>
<p>In future articles, we will explore Snowflake’s ML capabilities and add them to this series. Features will include native Snowflake preprocessing, a feature store, machine learning modeling, model registries, model management, Cortex baseline models, and more. Make sure to return to see how this series evolves.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Task Example of Executing Docker Image">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task Example of Executing Docker Image
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Here is an example of what this would look like as a task.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">or</span> <span class="kw">replace</span> task DEMO_TASK_1</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>USER_TASK_MANAGED_INITIAL_WAREHOUSE_SIZE <span class="op">=</span> <span class="st">'XSMALL'</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>SCHEDULE <span class="op">=</span><span class="st">'180 minutes'</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">as</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">EXECUTE</span> SERVICE</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">IN</span> <span class="kw">COMPUTE</span> POOL CONTAINER_DEMO_POOL</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> <span class="kw">SPECIFICATION</span> $$</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    spec:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      containers:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> name: modeling</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>          image: sfsenorthamerica<span class="op">-</span>demo<span class="op">-</span>jdemlow.registry.snowflakecomputing.com<span class="op">/</span>container_demo_db<span class="op">/</span><span class="kw">public</span><span class="op">/</span>image_repo<span class="op">/</span>modeling</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>          env:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            SNOWFLAKE_WAREHOUSE: CONTAINER_DEMO_WH</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            NOTEBOOK_FILE: <span class="ot">"nbs/99a_train_randomforest.ipynb"</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>          command:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span> <span class="ot">"/bin/bash"</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span> <span class="ot">"-c"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span> <span class="ot">"source /opt/venv/bin/activate &amp;&amp; { datetime=$(date +'%Y%m%d_%H%M%S'); jupyter nbconvert --execute --inplace --allow-errors --ExecutePreprocessor.timeout=-1 --NotebookApp.token='${JUPYTER_TOKEN}' ${NOTEBOOK_FILE} --output=executed_${datetime}.ipynb; }"</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>          volumeMounts:</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span> name: juypter<span class="op">-</span>nbs</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>              mountPath: <span class="op">/</span>home<span class="op">/</span>jupyter</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      networkPolicyConfig:</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>          allowInternetEgress: <span class="kw">true</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      volumes:</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> name: juypter<span class="op">-</span>nbs</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>          <span class="kw">source</span>: <span class="ot">"@volumes/juypter-nbs"</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">uid</span>: <span class="dv">1000</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>          gid: <span class="dv">1000</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    $$</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="set-up-for-code-walk-through" class="level1">
<h1>Set Up For Code Walk Through</h1>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">Prerequisites</h3>
<ul>
<li><p>Installed IDE of choice (Vscode, Pycharm, Intellij, etc), but will be showing VSCode.</p></li>
<li><p>Package Manager of your choice, but in this tutorial we are using miniconda installing instructions below.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Install Miniconda Script">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Install Miniconda Script
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-e</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-x</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="st">"</span><span class="va">$OSTYPE</span><span class="st">"</span> <span class="kw">in</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ss">darwin</span><span class="pp">*</span><span class="kw">)</span> <span class="va">DOWNLOAD</span><span class="op">=</span>https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">;;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ss">linux</span><span class="pp">*</span><span class="kw">)</span> <span class="va">DOWNLOAD</span><span class="op">=</span>https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">;;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="pp">*</span><span class="kw">)</span> <span class="bu">echo</span> <span class="st">"unknown: </span><span class="va">$OSTYPE</span><span class="st">"</span> <span class="cf">;;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">esac</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="st">"</span><span class="va">$SHELL</span><span class="st">"</span> <span class="kw">in</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ss">/bin/zsh</span><span class="pp">*</span><span class="kw">)</span> <span class="va">SHELL_NAME</span><span class="op">=</span>zsh <span class="cf">;;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="ss">/bin/bash</span><span class="pp">*</span><span class="kw">)</span> <span class="va">SHELL_NAME</span><span class="op">=</span>bash <span class="cf">;;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="pp">*</span><span class="kw">)</span> <span class="bu">echo</span> <span class="st">"unknown: </span><span class="va">$SHELL</span><span class="st">"</span> <span class="cf">;;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="cf">esac</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> .condarc</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="st">channels:</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="st">- conda-forge</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="st">- anaconda</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="st">- defaults</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="st">channel_priority: strict</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="va">$DOWNLOAD</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> Miniconda3-latest<span class="pp">*</span>.sh <span class="at">-b</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="ex">~/miniconda3/bin/conda</span> init <span class="va">$SHELL_NAME</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> Miniconda3-latest<span class="pp">*</span>.sh</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="fu">perl</span> <span class="at">-n</span> <span class="at">-e</span> <span class="st">'print if /&gt;&gt;&gt; conda/../&lt;&lt;&lt; conda/'</span> .bashrc <span class="op">&gt;</span> .condainit</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="fu">perl</span> <span class="at">-ni</span> <span class="at">-e</span> <span class="st">'print unless /&gt;&gt;&gt; conda/../&lt;&lt;&lt; conda/'</span> .bashrc</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> source ~/.condainit <span class="op">&gt;&gt;</span> .bashrc</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> .condainit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<ul>
<li><p>Installing SnowSql <a href="https://docs.snowflake.com/en/user-guide/snowsql-install-config">here</a></p></li>
<li><p>Docker installed and configured on your local machine <a href="https://docs.docker.com/get-docker/">here</a>, we will be using docker desktop.</p></li>
<li><p>A Snowflake account login with a role that has the ACCOUNTADMIN role. If not, you will need to work with your ACCOUNTADMIN to perform the initial account setup (e.g.&nbsp;creating the CONTAINER_USER_ROLE and granting required privileges, as well as creating the OAuth Security Integration).</p></li>
<li><p>A GitHub account with a repository set up for your project</p></li>
</ul>
<p><a href="https://quickstarts.snowflake.com/guide/intro_to_snowpark_container_services/index.html#0">Quick Start Intro To Container Services</a> is a great starting place to learn more about container services.</p>
</section>
<section id="create-local-conda-environment" class="level3">
<h3 class="anchored" data-anchor-id="create-local-conda-environment">Create Local Conda Environment</h3>
<blockquote class="blockquote">
<p><strong>Warning</strong>: You must have Conda installed on your computer already before you can proceed with this process. Also would be advised to run this in the terminal over the notebook and make sure that you close VScode and turn back on to get the environment as a kernel</p>
</blockquote>
<div id="cell-6" class="cell" data-metadata="{}">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> conda create <span class="op">--</span>name snowpark <span class="op">--</span>override<span class="op">-</span>channels <span class="op">-</span>c https:<span class="op">//</span>repo.anaconda.com<span class="op">/</span>pkgs<span class="op">/</span>snowflake python<span class="op">=</span><span class="fl">3.10</span> <span class="op">--</span>y<span class="op">;</span> conda activate snowpark<span class="op">;</span> pip install <span class="op">--</span>upgrade pip setuptools wheel<span class="op">;</span> pip install <span class="op">-</span>r ..<span class="op">/</span>infra<span class="op">/</span>requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once installed, you will want to switch your kernel to <code>snowpark</code>. You might need to close Jupyter and reopen it to switch to the correct environment.</p>
</section>
<section id="creating-a-symlink" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-symlink">Creating a Symlink</h3>
<div id="cell-9" class="cell" data-metadata="{}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Symlink for Notebook</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ! ln -s .../DataScience/ ./DataScience</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-libraries-needed" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries-needed">Load Libraries Needed</h3>
<div id="cell-11" class="cell" data-metadata="{}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-metadata="{}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> DataScience.connection <span class="im">import</span> create_snowflake_session, execute_sql_file</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snowflake.snowpark.version <span class="im">import</span> VERSION</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-session-and-execute-set-up" class="level3">
<h3 class="anchored">Create Session and Execute Set Up</h3>
<blockquote class="blockquote">
<p>If you don’t have your enviornment variables set for this then you will want to change the next cell to the following cell. There is also the assumption that you have a database, schema, warehouse and role for this article to work. You will also at some point need to ask your account admin to give you the correct permissions</p>
</blockquote>
<div id="cell-14" class="cell" data-metadata="{}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>session <span class="op">=</span> create_snowflake_session(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    user<span class="op">=</span>os.environ[<span class="st">'SNOWFLAKE_USER'</span>], <span class="co"># Create Enviornment Variables of fill out here</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    password<span class="op">=</span>os.environ[<span class="st">'SNOWFLAKE_PASSWORD'</span>], <span class="co"># Create Enviornment Variables of fill out here</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    account<span class="op">=</span>os.environ[<span class="st">'SNOWFLAKE_ACCOUNT'</span>], <span class="co"># Create Enviornment Variables of fill out here</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    database<span class="op">=</span><span class="st">'CONTAINER_DEMO_DB'</span>, <span class="co"># Being created in this tutorial</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    warehouse<span class="op">=</span><span class="st">'CONTAINER_DEMO_WH'</span>, <span class="co"># Being created in this tutorial</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span><span class="st">'PUBLIC'</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    role<span class="op">=</span><span class="st">'ACCOUNTADMIN'</span>, <span class="co"># Defaulting to ACCOUNTADMIN for tutorial purposes</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>session.sql_simplifier_enabled <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>snowflake_environment <span class="op">=</span> session.sql(<span class="st">'SELECT current_user(), current_version()'</span>).collect()</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>snowpark_version <span class="op">=</span> VERSION</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Connection Established with the following parameters:'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'User                        : </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(snowflake_environment[<span class="dv">0</span>][<span class="dv">0</span>]))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Role                        : </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(session.get_current_role()))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Database                    : </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(session.get_current_database()))</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Schema                      : </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(session.get_current_schema()))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Warehouse                   : </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(session.get_current_warehouse()))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Snowflake version           : </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(snowflake_environment[<span class="dv">0</span>][<span class="dv">1</span>]))</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Snowpark for Python version : </span><span class="sc">{}</span><span class="st">.</span><span class="sc">{}</span><span class="st">.</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(snowpark_version[<span class="dv">0</span>],snowpark_version[<span class="dv">1</span>],snowpark_version[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell" data-metadata="{}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>execute_sql_file(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    session,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    file_path<span class="op">=</span><span class="st">'DataScience/files/sql/00_setup.sql'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/00_setup.png" class="img-fluid figure-img"></p>
<figcaption>SetUp Creates</figcaption>
</figure>
</div>
<p>We want to make We want to ensure our image repository was created, so we will run the following command: out image repository was created so we will run the following command</p>
<div id="cell-18" class="cell" data-metadata="{}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing 'repository_url' column from output to secure the URL link</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>display(pd.DataFrame(session.sql(<span class="ss">f"SHOW IMAGE REPOSITORIES;"</span>).collect())[[<span class="st">'created_on'</span>, <span class="st">'name'</span>, <span class="st">'database_name'</span>, <span class="st">'schema_name'</span>, <span class="st">'owner'</span>, <span class="st">'owner_role_type'</span>, <span class="st">'comment'</span>, <span class="st">'repository_url'</span>]])</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(session.sql(<span class="ss">f"SHOW IMAGE REPOSITORIES;"</span>).collect())[[<span class="st">'repository_url'</span>]].values[<span class="dv">0</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>^^string above is going to be your repository that you will put into the cells below to make your make file.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Explain Setup Execution Code">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explain Setup Execution Code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<section id="snowflake-setup-for-container-usage" class="level1 callout-body-container callout-body">
<h1>Snowflake Setup for Container Usage</h1>
<p>This documentation outlines the steps to configure Snowflake for container usage, emphasizing on roles, warehouses, databases, and stages setup, specifically tailored for modeling and development purposes.</p>
<section id="step-1-create-a-role-with-required-privileges" class="level2">
<h2 class="anchored" data-anchor-id="step-1-create-a-role-with-required-privileges">Step 1: Create a Role with Required Privileges</h2>
<p>First, we initiate the process by switching to the <code>ACCOUNTADMIN</code> role to create a new role named <code>CONTAINER_USER_ROLE</code>. This role is then granted a set of privileges that are essential for the management and operation of databases, warehouses, and integrations within Snowflake. These privileges are crucial for creating and managing the infrastructure needed for containerized applications.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> <span class="kw">ROLE</span> ACCOUNTADMIN;</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="kw">ON</span> <span class="kw">ACCOUNT</span> <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">CREATE</span> WAREHOUSE <span class="kw">ON</span> <span class="kw">ACCOUNT</span> <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">COMPUTE</span> POOL <span class="kw">ON</span> <span class="kw">ACCOUNT</span> <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">CREATE</span> INTEGRATION <span class="kw">ON</span> <span class="kw">ACCOUNT</span> <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> MONITOR <span class="kw">USAGE</span> <span class="kw">ON</span> <span class="kw">ACCOUNT</span> <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> BIND SERVICE ENDPOINT <span class="kw">ON</span> <span class="kw">ACCOUNT</span> <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> IMPORTED <span class="kw">PRIVILEGES</span> <span class="kw">ON</span> <span class="kw">DATABASE</span> snowflake <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-grant-the-new-role-to-accountadmin" class="level2">
<h2 class="anchored" data-anchor-id="step-2-grant-the-new-role-to-accountadmin">Step 2: Grant the New Role to <code>ACCOUNTADMIN</code></h2>
<p>After creating the <code>CONTAINER_USER_ROLE</code>, it’s necessary to grant this role to the <code>ACCOUNTADMIN</code> to ensure the administrator can utilize this new role. This step integrates the newly created role within the organizational roles hierarchy, allowing for seamless role management and access control.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE <span class="kw">TO</span> <span class="kw">ROLE</span> ACCOUNTADMIN;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-create-and-configure-a-warehouse" class="level2">
<h2 class="anchored" data-anchor-id="step-3-create-and-configure-a-warehouse">Step 3: Create and Configure a Warehouse</h2>
<p>Next, we focus on setting up a warehouse named <code>CONTAINER_DEMO_WH</code> with specified parameters to support the operational needs of container usage. This includes defining the warehouse size, auto-suspend, and auto-resume settings to optimize resource utilization.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> WAREHOUSE CONTAINER_DEMO_WH</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>WAREHOUSE_SIZE <span class="op">=</span> XSMALL</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>AUTO_SUSPEND <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>AUTO_RESUME <span class="op">=</span> <span class="kw">TRUE</span>;</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> OWNERSHIP <span class="kw">ON</span> WAREHOUSE CONTAINER_DEMO_WH <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE <span class="kw">REVOKE</span> <span class="kw">CURRENT</span> GRANTS;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-setup-database-and-stages" class="level2">
<h2 class="anchored" data-anchor-id="step-4-setup-database-and-stages">Step 4: Setup Database and Stages</h2>
<p>With the <code>CONTAINER_USER_ROLE</code>, we proceed to create a database <code>CONTAINER_DEMO_DB</code> and configure stages for different purposes, including specs, volumes, and RDF models. Each stage is set up with encryption and directory enablement, tailored for specific use cases such as storing Docker image commands, data development, and modeling purposes.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">DATABASE</span> CONTAINER_DEMO_DB;</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> <span class="kw">DATABASE</span> CONTAINER_DEMO_DB;</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> STAGE <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> SPECS</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>ENCRYPTION <span class="op">=</span> (<span class="kw">TYPE</span><span class="op">=</span><span class="st">'SNOWFLAKE_SSE'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">DIRECTORY</span> <span class="op">=</span> (<span class="kw">ENABLE</span> <span class="op">=</span> <span class="kw">TRUE</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">COMMENT</span> <span class="op">=</span> <span class="st">'Store Docker Image Commands for SPECS'</span>;</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> STAGE <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> VOLUMES</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>ENCRYPTION <span class="op">=</span> (<span class="kw">TYPE</span><span class="op">=</span><span class="st">'SNOWFLAKE_SSE'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="kw">DIRECTORY</span> <span class="op">=</span> (<span class="kw">ENABLE</span> <span class="op">=</span> <span class="kw">TRUE</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">COMMENT</span> <span class="op">=</span> <span class="st">'Saving Data As We Develop In Snowflake'</span>;</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> STAGE <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> RDF_MODEL</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>ENCRYPTION <span class="op">=</span> (<span class="kw">TYPE</span><span class="op">=</span><span class="st">'SNOWFLAKE_SSE'</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="kw">DIRECTORY</span> <span class="op">=</span> (<span class="kw">ENABLE</span> <span class="op">=</span> <span class="kw">TRUE</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="kw">COMMENT</span> <span class="op">=</span> <span class="st">'For This Use Case'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-create-and-configure-image-repository" class="level2">
<h2 class="anchored" data-anchor-id="step-5-create-and-configure-image-repository">Step 5: Create and Configure Image Repository</h2>
<p>Finally, an image repository named <code>IMAGE_REPO</code> is created within the <code>CONTAINER_DEMO_DB.PUBLIC</code> schema for modeling usage. This repository is essential for managing container images, facilitating the development and deployment process. Access rights are granted to the <code>CONTAINER_USER_ROLE</code> for both reading and writing, ensuring the role can fully utilize the repository for container management.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> IMAGE REPOSITORY CONTAINER_DEMO_DB.<span class="kw">PUBLIC</span>.IMAGE_REPO</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">COMMENT</span> <span class="op">=</span> <span class="st">'This is for modeling usage'</span>;</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">READ</span> <span class="kw">ON</span> STAGE CONTAINER_DEMO_DB.<span class="kw">PUBLIC</span>.RDF_MODEL <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">WRITE</span> <span class="kw">ON</span> STAGE CONTAINER_DEMO_DB.<span class="kw">PUBLIC</span>.RDF_MODEL <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">READ</span> <span class="kw">ON</span> IMAGE REPOSITORY CONTAINER_DEMO_DB.<span class="kw">PUBLIC</span>.IMAGE_REPO <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">WRITE</span> <span class="kw">ON</span> IMAGE REPOSITORY CONTAINER_DEMO_DB.<span class="kw">PUBLIC</span>.IMAGE_REPO <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</div>
</div>
</section>
<section id="configure-yaml-files" class="level2">
<h2 class="anchored" data-anchor-id="configure-yaml-files">Configure Yaml Files</h2>
<blockquote class="blockquote">
<p><strong>Warning</strong>: Set up config.toml with snow sql need to be set up before running configure.sh and ensure Docker is on your computer</p>
</blockquote>
<div id="cell-22" class="cell" data-metadata="{}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The last output of this will be the url you put here</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> rm ..<span class="op">/</span>modeling.yaml</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> rm ..<span class="op">/</span>Makefile</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> bash ..<span class="op">/</span>infra<span class="op">/</span>configure.sh <span class="op">-</span>r <span class="st">"&lt;CHANGE_TO_YOUR_REPOSITORY_URL_HERE"</span> <span class="op">-</span>w <span class="st">"CONTAINER_DEMO_WH"</span> <span class="op">-</span>i <span class="st">"modeling"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-metadata="{}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> cat ..<span class="op">/</span>modeling.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="move-newly-created-spec-file-modeling.yaml-to-stage-specs" class="level4">
<h4 class="anchored" data-anchor-id="move-newly-created-spec-file-modeling.yaml-to-stage-specs">Move Newly Created Spec File (modeling.yaml) to Stage <span class="citation" data-cites="specs">@specs</span></h4>
<div id="cell-25" class="cell" data-metadata="{}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>stage_location <span class="op">=</span> <span class="vs">r'@specs'</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>stage_location <span class="op">=</span> stage_location.strip(<span class="st">'@'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'../modeling.yaml'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>put_results <span class="op">=</span> session.<span class="bu">file</span>.put(local_file_name<span class="op">=</span>file_path, stage_location<span class="op">=</span>stage_location, auto_compress<span class="op">=</span><span class="va">False</span>, overwrite<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> put_results:</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"File: </span><span class="sc">{</span>result<span class="sc">.</span>source<span class="sc">}</span><span class="ss">, Status: </span><span class="sc">{</span>result<span class="sc">.</span>status<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>display(pd.DataFrame(session.sql(<span class="st">'ls @specs'</span>).collect()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="docker-creation" class="level2">
<h2 class="anchored" data-anchor-id="docker-creation">Docker Creation</h2>
<section id="run-docker-build-locally" class="level3">
<h3 class="anchored" data-anchor-id="run-docker-build-locally">Run Docker Build Locally</h3>
<blockquote class="blockquote">
<p>We want you to test this locally by designed to allow you to have a better understanding <code>make build_local; make run</code> and make sure it’s working as you would expect it then move on to the next steps.</p>
</blockquote>
<ol type="1">
<li><p>Download docker desktop and ensure it is open and running.</p>
<ul>
<li><blockquote class="blockquote">
<p><strong>Warning</strong>: Make sure you have docker running and make sure you have logged in already <code>~/.docker/config.json</code> you can check this or run docker login in the terminal</p>
</blockquote></li>
<li><blockquote class="blockquote">
<p><strong>Also make sure you make your .env file in infra</strong> for your enviornment vairiables to be used in your docker-compose.yaml. As you grow out of this tutorial mode the next step here would be to create github actions to create these approaches so that you are able to run this in a more devops style approach. In future versions this will be shown.</p>
</blockquote></li>
</ul></li>
<li><p>Open Terminal navigate to this repo and run <code>make build_local</code></p>
<ul>
<li>If you are using VS code you can simple click terminal and paste the command</li>
</ul></li>
<li><p>After your local build is complete you can then run <code>make run</code>.</p>
<ul>
<li>This is going to be running a docker compose process that can be viewed inside of the infra/ folder</li>
</ul></li>
</ol>
<section id="pictures-of-steps" class="level4">
<h4 class="anchored" data-anchor-id="pictures-of-steps">Pictures of Steps</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/make_build_local.png" class="img-fluid figure-img"></p>
<figcaption>Make build</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/jupyterlab_1.png" class="img-fluid figure-img"></p>
<figcaption>Jupyterlab Initial</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/jupyterlab_2.png" class="img-fluid figure-img"></p>
<figcaption>Jupyterlab Logged In</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/jupyterlab_3.png" class="img-fluid figure-img"></p>
<figcaption>Jupyterlab Execute Imports</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p><strong>Note</strong>: As SPCS will not allow your volumes to be respected in a two way methodology we have observed that COPY statements in your dockerfile which land in a directory which are then stage-mounted as a volume will NOT initialize the file in-stage. We have on open product gap for this but has thus far been low-priority currently so we are going to bring this repo to our development experience using the github, gitlab, bitbucket etc integrations later on in this process. So if you are wondering why we are using gh cli to bring the repo to the docker image this is one of the reasons.</p>
</blockquote>
<blockquote class="blockquote">
<p>You also need to make sure you are able to login in with snowql and snow cli to be able to run the following commands</p>
</blockquote>
</section>
</section>
<section id="pushing-image-to-snowflake" class="level3">
<h3 class="anchored">Pushing Image To Snowflake</h3>
<blockquote class="blockquote">
<p>make all will –&gt; Login, Create, Push To Snowflake</p>
</blockquote>
<div id="cell-27" class="cell" data-metadata="{}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> cd ..<span class="op">/</span> <span class="op">&amp;&amp;</span>  make <span class="bu">all</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Explain Make File Call">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explain Make File Call
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I wanted to make sure that before we continue that we are taking a moment to understand the development life cyle of what we are building.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/docker_image_lifecycle.png" class="img-fluid figure-img"></p>
<figcaption>docker image life cycle</figcaption>
</figure>
</div>
<p>When you run your <code>make all</code> command you are moving your docker image so that you are able to use this image as part of the service. This is a great picture below to show you what is actaully happening inside of snowflake with snowpark container services.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/docker_push.png" class="img-fluid figure-img"></p>
<figcaption>docker push</figcaption>
</figure>
</div>
<p>The <code>make all</code> command in the context of a Makefile is a target that typically encompasses a series of dependent tasks required to build a project. It’s designed to automate the process of compiling, building, and preparing a software application or service. Here’s a step-by-step explanation of what <code>make all</code> does in the provided Makefile script:</p>
<ol type="1">
<li><p><strong><code>login:</code></strong> This target logs into the Snowflake Docker repository. It’s the initial step to ensure that subsequent operations, such as pushing a Docker image, can authenticate against the Snowflake registry. The <code>docker login</code> command uses the <code>$(SNOWFLAKE_REPO)</code> variable, which should contain the URL of the Snowflake Docker repository.</p></li>
<li><p><strong><code>build:</code></strong> This target builds a Docker image for Snowpark Container Services. It specifies the platform as <code>linux/amd64</code>, uses a Dockerfile located in the <code>infra</code> directory, and tags the resulting image with the name specified in the <code>$(DOCKER_IMAGE)</code> variable. This step prepares the Docker image with the necessary environment and dependencies for the application.</p></li>
<li><p><strong><code>push_docker:</code></strong> After the Docker image is built, this target tags and pushes it to the Snowflake Container Services repository specified in the <code>$(SNOWFLAKE_REPO)</code> variable. This makes the Docker image available in Snowflake’s registry, allowing it to be used in Snowflake Container Services.</p></li>
</ol>
<p>In summary, <code>make all</code> in this script is a composite command that automates the workflow of logging into the Snowflake Docker repository, building a Docker image tailored for Snowpark Container Services, and pushing the built image to the Snowflake repository. This streamlines the deployment process, ensuring that the Docker image is readily available in Snowflake for running services or applications.</p>
</div>
</div>
</div>
<div id="cell-29" class="cell" data-metadata="{}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>execute_sql_file(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    session,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    file_path<span class="op">=</span><span class="st">'DataScience/files/sql/01_container_services.sql'</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Choosing your correct compute pools is going to be something that you will need to make sure you are choosing for you specific use case, but you can find all the compute pools currently available to each snowflake account. <a href="https://docs.snowflake.com/en/developer-guide/snowpark-container-services/working-with-compute-pool#creating-a-compute-pool">Compute Pools Engines</a> are just like any of our other warehouses fully elastic and if you need more please reach out to snowflake to increase your quota.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Explain Container Services Execution Code">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explain Container Services Execution Code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<section id="snowflake-configuration-for-enhanced-security-and-services" class="level1 callout-body-container callout-body">
<h1>Snowflake Configuration for Enhanced Security and Services</h1>
<p>This documentation guides you through the process of configuring Snowflake for enhanced security measures and service creation, specifically tailored for modeling and development purposes within containerized environments.</p>
<section id="step-1-create-security-integration-for-oauth" class="level2">
<h2 class="anchored" data-anchor-id="step-1-create-security-integration-for-oauth">Step 1: Create Security Integration for OAuth</h2>
<p>The process begins with the creation of an OAuth security integration. This is a critical step for setting up authentication mechanisms, ensuring secure access to Snowflake services.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> <span class="kw">ROLE</span> ACCOUNTADMIN;</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> SECURITY INTEGRATION <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> snowservices_ingress_oauth</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TYPE</span><span class="op">=</span>oauth</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  OAUTH_CLIENT<span class="op">=</span>snowservices_ingress</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  ENABLED<span class="op">=</span><span class="kw">true</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-configure-network-rules-and-external-access" class="level2">
<h2 class="anchored" data-anchor-id="step-2-configure-network-rules-and-external-access">Step 2: Configure Network Rules and External Access</h2>
<p>Following the security setup, network rules are defined to allow outbound traffic, facilitating external communications. An external access integration is also created to authorize this specified traffic, bolstering the security framework.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">NETWORK</span> <span class="kw">RULE</span> ALLOW_ALL_RULE</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TYPE</span> <span class="op">=</span> <span class="st">'HOST_PORT'</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">MODE</span> <span class="op">=</span> <span class="st">'EGRESS'</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  VALUE_LIST<span class="op">=</span> (<span class="st">'0.0.0.0:443'</span>, <span class="st">'0.0.0.0:80'</span>);</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> EXTERNAL <span class="kw">ACCESS</span> INTEGRATION ALLOW_ALL_EAI</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  ALLOWED_NETWORK_RULES <span class="op">=</span> (ALLOW_ALL_RULE)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  ENABLED <span class="op">=</span> <span class="kw">true</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-grant-usage-on-integrations" class="level2">
<h2 class="anchored" data-anchor-id="step-3-grant-usage-on-integrations">Step 3: Grant Usage on Integrations</h2>
<p>Permissions are then granted to the <code>CONTAINER_USER_ROLE</code> for the external access integration, ensuring the role has the necessary access to utilize the integration for service communications.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> INTEGRATION ALLOW_ALL_EAI <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-create-and-modify-compute-pool" class="level2">
<h2 class="anchored" data-anchor-id="step-4-create-and-modify-compute-pool">Step 4: Create and Modify Compute Pool</h2>
<p>A compute pool is established with specific node limits and an instance family, aligning with processing needs. This step also includes provisions for modifying the compute pool’s configuration to adjust resources as needed.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">COMPUTE</span> POOL <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> CONTAINER_DEMO_POOL</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  MIN_NODES <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  MAX_NODES <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  INSTANCE_FAMILY <span class="op">=</span> standard_1;</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> <span class="kw">COMPUTE</span> POOL CONTAINER_DEMO_POOL <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-create-modeling-snowpark-service" class="level2">
<h2 class="anchored" data-anchor-id="step-5-create-modeling-snowpark-service">Step 5: Create Modeling Snowpark Service</h2>
<p>Next, a Snowpark service named <code>MODELING_SNOWPARK_SERVICE</code> is created using the specified compute pool. This service is designed for modeling purposes, incorporating external access integrations and specification details for optimal functionality.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> SERVICE CONTAINER_DEMO_DB.<span class="kw">PUBLIC</span>.MODELING_SNOWPARK_SERVICE</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span> <span class="kw">compute</span> pool CONTAINER_DEMO_POOL</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> @SPECS</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>specification_file<span class="op">=</span><span class="st">'modeling.yaml'</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>external_access_integrations <span class="op">=</span> (ALLOW_ALL_EAI)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>MIN_INSTANCES<span class="op">=</span><span class="dv">1</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>MAX_INSTANCES<span class="op">=</span><span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-6-user-creation-and-role-assignment" class="level2">
<h2 class="anchored" data-anchor-id="step-6-user-creation-and-role-assignment">Step 6: User Creation and Role Assignment</h2>
<p>Finally, a user is created with specified credentials, default role, and warehouse settings. The <code>CONTAINER_USER_ROLE</code> is granted to the user, along with usage permissions on various resources to ensure comprehensive access and operational capabilities.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> <span class="kw">ROLE</span> ACCOUNTADMIN;</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="fu">USER</span> RANDOMEMPLOYEE</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="st">'Snowflake2024'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>DEFAULT_ROLE <span class="op">=</span> <span class="st">'CONTAINER_USER_ROLE'</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>DEFAULT_WAREHOUSE <span class="op">=</span> <span class="st">'CONTAINER_DEMO_WH'</span>;</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE <span class="kw">TO</span> <span class="fu">USER</span> RANDOMEMPLOYEE;</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> WAREHOUSE CONTAINER_DEMO_WH <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> SERVICE CONTAINER_DEMO_DB.<span class="kw">PUBLIC</span>.MODELING_SNOWPARK_SERVICE <span class="kw">TO</span> <span class="kw">ROLE</span> CONTAINER_USER_ROLE;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</div>
</div>
</section>
</section>
<section id="look-into-service-created" class="level2">
<h2 class="anchored" data-anchor-id="look-into-service-created">Look Into Service Created</h2>
<div id="cell-33" class="cell" data-metadata="{}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>session.sql(<span class="st">"SHOW SERVICES;"</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Remember</strong>: That this will take a few minutes of your service to be up and running so you will be able run the following command again and it will give you the url link that will allow you to log into your app with the correct Username and Password.</p>
<blockquote class="blockquote">
<p><code>CALL SYSTEM$GET_SERVICE_STATUS('CONTAINER_DEMO_DB.PUBLIC.MODELING_SNOWPARK_SERVICE');</code> You can also try this command to see the status of your service you might get an ingress_url before the pending state is resolved.</p>
</blockquote>
<div id="cell-35" class="cell" data-metadata="{}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> pd.DataFrame(session.sql(<span class="st">"SHOW ENDPOINTS IN SERVICE MODELING_SNOWPARK_SERVICE;"</span>).collect())</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>display(temp)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(temp[<span class="st">"ingress_url"</span>].values[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assuming ingest_url contains the URL you want to copy and paste this URL into your browser and enjoy your modeling jupyter notebook.</p>
<ol type="1">
<li>Open in web broswer and paste the ingress_url</li>
<li>This will open a login page for this demo it is
<ul>
<li>Usename: RandomEmployee</li>
<li>Password: Snowflake2024</li>
</ul></li>
<li>Development App Will Load and Your Application is ready to go</li>
</ol>
</section>
</section>
<section id="snowflake-application-deployment" class="level1">
<h1>Snowflake Application Deployment</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This guide will walk you through the process of working with the new Snowflake application. We will walk through how to log in and then cloning a repository, setting up GitHub secrets, triggering a GitHub Actions workflow, and exploring the resulting models and predictions stored in Snowflake.</p>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<p>With the Docker image now deployed and ready, we are poised to explore the capabilities of our newly created application. Navigate to a website with a URL ending in <code>.snowflakecomputing.app</code> to begin.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/openapp.png" class="img-fluid figure-img"></p>
<figcaption>Open Application</figcaption>
</figure>
</div>
<p>Upon reaching the site, log in using the credentials for “RandomEmployee”. This process grants access to your development ecosystem.</p>
<blockquote class="blockquote">
<p><strong>Warning</strong>: Allow 5-10 minutes for the application to become fully operational. Initial errors can often be resolved by refreshing the page or attempting to log in again after a brief wait.</p>
</blockquote>
<p>The next step involves using a secure token found within your Docker Image. If unchanged, the default token “my_secure_token” enhances application security, although its use is optional.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/login_first_page.png" class="img-fluid figure-img"></p>
<figcaption>First Screen Add Token</figcaption>
</figure>
</div>
<p>Post-login, you may notice the development ecosystem appears empty. This is due to the absence of a cloned repository. Although it may seem unconventional, cloning a repo into the development application addresses a known product gap, set for future resolution. Additionally, integration with Git in PrPr is forthcoming, offering a more streamlined experience with repositories.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/open_terminal.png" class="img-fluid figure-img"></p>
<figcaption>Open Terminal as Jupyter Lab Is Empty</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/clone_repo.png" class="img-fluid figure-img"></p>
<figcaption>Clone Repo to Jupyter Lab Session</figcaption>
</figure>
</div>
<p>This will prompt your user name and password you can use a personal token to allow for yourself to load in your repo, but there are many other ways, but to keep it simple in this tutorial this was a good way to get this done quickly.</p>
<p>Having cloned your repository, feel free to start development. Remember to push changes back to your Git repository to remain updated with the latest revisions. Your code is safely stored in a designated volume, accessible via <code>ls @volumes/jupyter-nbs/</code> in Snowflake, complying with specified requirements.</p>
</section>
<section id="github-integration" class="level2">
<h2 class="anchored" data-anchor-id="github-integration">GitHub Integration</h2>
<p>To integrate your project with GitHub and enable automated workflows, follow these steps:</p>
<ol type="1">
<li><p><strong>Set up GitHub Secrets</strong>: Ensure your GitHub repository contains the necessary secrets for authentication and access to your Snowflake instance. The setup should resemble the image below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/add_secerts.png" class="img-fluid figure-img"></p>
<figcaption>Add GitHub Secrets</figcaption>
</figure>
</div>
<p>Refer to the <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">GitHub Secrets documentation</a> for detailed instructions on how to create and manage secrets for your repository.</p></li>
<li><p><strong>Configure GitHub Actions</strong>: With GitHub secrets in place, navigate to your repository’s GitHub Actions to trigger the workflow.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/github_action.png" class="img-fluid figure-img"></p>
<figcaption>Go to Repo Actions</figcaption>
</figure>
</div></li>
<li><p><strong>Trigger the Workflow</strong>: Manually trigger the workflow by selecting the appropriate action and providing any necessary inputs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/run_github_action.png" class="img-fluid figure-img"></p>
<figcaption>Trigger Workflow</figcaption>
</figure>
</div>
<p>Successfully triggering the workflow culminates in the construction of a RandomForestRegressor. This model, once trained, is utilized for predictions, subsequently recorded back into Snowflake. Future tutorials will delve into more sophisticated workflows, enhancing your data science projects within Snowflake.</p></li>
</ol>
<blockquote class="blockquote">
<p><strong>Caution</strong>: This tutorial does not encompass the entirety of a data science project’s requirements. It serves as an introductory guide, with plans to expand on Snowflake’s native ML capabilities, Cortex, and other projects. Stay tuned for updates and explore different branches for additional developments.</p>
</blockquote>
</section>
<section id="exploring-results" class="level2">
<h2 class="anchored" data-anchor-id="exploring-results">Exploring Results</h2>
<p>After workflow completion, delve into the notebooks for insights and outcomes verification.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/click_jobs_nbs.png" class="img-fluid figure-img"></p>
<figcaption>Click into job_nbs</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/jobs_ran_from_github.png" class="img-fluid figure-img"></p>
<figcaption>Click into RanJobs</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/result_of_action.png" class="img-fluid figure-img"></p>
<figcaption>Result of GitHub Actions</figcaption>
</figure>
</div>
<p>Reviewing these notebooks aids in debugging and ensures everything performed as expected.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/look_at_ran_nbs.png" class="img-fluid figure-img"></p>
<figcaption>Explore Inference Notebook Run</figcaption>
</figure>
</div>
<p>For continued exploration, re-triggering the notebook facilitates additional predictions, exemplifying how automation, such as cron jobs in GitHub, can enhance your workflow.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/run_again.png" class="img-fluid figure-img"></p>
<figcaption>Run Action Again</figcaption>
</figure>
</div>
<p>Finally, view the prediction outcomes within your Snowflake database.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/final_result.png" class="img-fluid figure-img"></p>
<figcaption>Snowflake Database</figcaption>
</figure>
</div>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<p>If you encounter any issues during the deployment process, here are some common troubleshooting steps:</p>
<ol type="1">
<li><strong>Login Issues</strong>: If you’re unable to log in, ensure that you’re using the correct credentials and that the application has had sufficient time to become operational.</li>
<li><strong>GitHub Secrets</strong>: Double-check that your GitHub secrets are set up correctly and that the required permissions are in place.</li>
<li><strong>Workflow Errors</strong>: Review the output from the GitHub Actions workflow for any error messages or clues about what might be causing the issue.</li>
<li><strong>Snowflake Connectivity</strong>: Verify that your Snowflake instance is accessible and that you have the necessary permissions to interact with it.</li>
</ol>
<p>If the issue persists, feel free to reach out to the support team for further assistance.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<p>For more advanced topics, code examples, and updates, please refer to the following resources:</p>
<ul>
<li><a href="https://docs.snowflake.com/">Snowflake Documentation</a></li>
<li><a href="https://github.com/snowflakedb">Snowflake GitHub Repository</a></li>
<li><a href="https://community.snowflake.com/">Snowflake Community</a></li>
<li><a href="https://docs.github.com/en/actions">GitHub Actions Documentation</a></li>
</ul>
<p>We encourage you to provide feedback on this documentation by submitting issues or pull requests.</p>
<blockquote class="blockquote">
<p>WARNING: This is intended for development purposes only and has not been approved by security or infosec for deployment. If you plan to deploy this, be aware of the risks, as it has not been fully secured. Please consult with your data governance teams to ensure safe deployment.</p>
</blockquote>
</section>
</section>
<section id="clean-up" class="level1">
<h1>Clean Up</h1>
<div id="cell-39" class="cell" data-metadata="{}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>execute_sql_file(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    session,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    file_path<span class="op">=</span><span class="st">'DataScience/files/sql/03_teardown.sql'</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This was just as simple example of the power of creating modeling application with in snowflake in a fast an secure fashion that you are able to share with your teams across your organizations please make sure you come back for more examples like this as we will begin to build more and more use cases inside of the SPCS as this is going to be a powerful building block to unlock the full potential of snowflake as a platform.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/sfc-gh-jdemlow\.github\.io\/SPCSDataScience");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sfc-gh-jdemlow/SPCSDataScience/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>